# 03 - 项目代码结构

本文档详细介绍了项目的代码结构和各个组件的作用。

## 项目目录结构

```
tekton-poc/
├── .github/
│   └── workflows/
│       └── tekton-ci.yml          # GitHub Actions工作流配置
├── .tekton/
│   ├── task-pytest.yaml           # Tekton Task定义
│   ├── pipeline.yaml              # Tekton Pipeline定义
│   └── pipelinerun.yaml           # Tekton PipelineRun模板
├── src/
│   └── calculator.py              # 计算器模块（业务代码）
├── tests/
│   └── test_calculator.py         # pytest测试文件
├── k8s-configs/
│   └── tekton-dashboard-ingress.yaml  # Tekton Dashboard Ingress配置
├── docs/
│   ├── zh/                        # 中文文档
│   └── en/                        # 英文文档
├── main.py                        # 主程序入口
├── requirements.txt               # Python依赖
└── README.md                      # 项目说明
```

## 核心代码组件

### 1. 业务代码 (`src/calculator.py`)

这是一个简单的计算器类，包含基本的数学运算功能：

```python
class Calculator:
    def add(self, a, b):        # 加法
    def subtract(self, a, b):   # 减法
    def multiply(self, a, b):   # 乘法
    def divide(self, a, b):     # 除法（包含除零检查）
    def power(self, base, exponent):  # 幂运算
```

**特点：**
- 包含错误处理（除零异常）
- 简单易测试的纯函数
- 符合单一职责原则

### 2. 测试代码 (`tests/test_calculator.py`)

全面的pytest测试套件，包括：

```python
class TestCalculator:
    # 基础功能测试
    def test_add_positive_numbers()
    def test_add_negative_numbers()
    def test_add_zero()
    def test_subtract()
    def test_multiply()
    def test_divide()
    def test_divide_by_zero()      # 异常测试
    def test_power()
    def test_power_edge_cases()

class TestCalculatorIntegration:
    # 集成测试
    def test_complex_calculation()
    def test_calculator_state_independence()
```

**测试覆盖率：**
- ✅ 正常情况测试
- ✅ 边界条件测试
- ✅ 异常情况测试
- ✅ 集成测试

### 3. 主程序 (`main.py`)

项目的入口点，演示计算器功能：

```python
def main():
    print("=== Tekton POC Project ===")
    print("Running calculator demo...")
    calculator_main()
```

### 4. 依赖管理 (`requirements.txt`)

项目依赖配置：

```
pytest==7.4.4      # 测试框架
pytest-cov==4.1.0  # 测试覆盖率工具
```

## 运行和测试

### 本地运行

```bash
# 运行主程序
python3 main.py

# 运行测试（需要先安装依赖）
python3 -m pip install -r requirements.txt
python3 -m pytest tests/ -v
```

### 预期输出

**主程序输出：**
```
=== Tekton POC Project ===
Running calculator demo...
Calculator POC Demo
==================
5 + 3 = 8
10 - 4 = 6
6 * 7 = 42
15 / 3 = 5.0
2 ^ 4 = 16
```

**测试输出：**
```
tests/test_calculator.py::TestCalculator::test_add_positive_numbers PASSED
tests/test_calculator.py::TestCalculator::test_add_negative_numbers PASSED
tests/test_calculator.py::TestCalculator::test_add_zero PASSED
...
```

## 代码质量

### 编码规范
- 遵循PEP 8 Python编码规范
- 包含完整的文档字符串
- 使用类型提示（可选）

### 测试策略
- **单元测试**: 测试每个方法的独立功能
- **边界测试**: 测试特殊值（0, 负数, 小数等）
- **异常测试**: 验证错误处理（除零异常）
- **集成测试**: 测试多个操作的组合

### 最佳实践
- ✅ 代码和测试分离
- ✅ 清晰的目录结构
- ✅ 完整的错误处理
- ✅ 可重复的测试
- ✅ 文档化的API

## CI/CD集成

这个简单的代码结构非常适合CI/CD流程：

1. **易于构建**: Python代码无需编译
2. **快速测试**: pytest测试执行迅速
3. **清晰反馈**: 测试结果明确
4. **容器友好**: 可以轻松在Docker容器中运行

## 扩展建议

如果要扩展这个POC项目，可以考虑：

### 代码扩展
- 添加更多数学函数（三角函数、对数等）
- 增加输入验证
- 添加配置文件支持
- 实现REST API接口

### 测试扩展
- 添加性能测试
- 增加测试覆盖率报告
- 集成静态代码分析
- 添加安全性测试

### 工程扩展
- 添加Dockerfile
- 配置代码格式化工具（black, flake8）
- 集成代码质量检查
- 添加版本管理

## 下一步

代码结构创建完成后，请继续阅读：
- [04 - GitHub Actions配置](./04-GitHub-Actions配置.md)
