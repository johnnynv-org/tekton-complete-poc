# 01 - 项目概述

## 项目简介

本项目是一个GitHub Actions + Tekton的POC（概念验证），演示从GitHub代码提交到Tekton执行pytest的完整CI/CD流程。

## 架构设计

### 思路一：直接kubectl模式（已弃用）
```
GitHub Push → Runner → kubectl apply → Tekton Pipeline
```
**问题：** Runner承担过多职责，违反生产最佳实践

### 思路二：Tekton Triggers模式（当前采用）
```
┌─────────────────┐    ┌───────────────────┐    ┌─────────────────────────┐
│                 │    │                   │    │   Kubernetes Cluster   │
│  GitHub Repo    │───▶│  Self-hosted      │───▶│  ┌─────────────────────┐│
│  (tekton-poc)   │    │  GitHub Runner    │    │  │ Tekton EventListener││
│                 │    │ swqa-gh-runner-poc│    │  │  (Internal Service) ││
└─────────────────┘    └───────────────────┘    │  └─────────────────────┘│
         │                       │              │           │             │
         │                       │              │           ▼             │
    代码推送触发              HTTP POST           │  ┌─────────────────────┐│
                            到内网服务            │  │   Tekton Pipeline   ││
                                                 │  │   (执行pytest)      ││
                                                 │  └─────────────────────┘│
                                                 └─────────────────────────┘
```

**优势：**
- **职责分离**: Runner只负责触发，不执行业务逻辑
- **安全隔离**: Tekton完全内网，无外部暴露
- **生产级**: 符合企业级CI/CD最佳实践

## 核心组件

### 1. GitHub Repository
- 包含Python代码和pytest测试
- GitHub Actions workflow配置
- Tekton资源配置文件（Pipeline, Task, EventListener等）

### 2. 自宿主GitHub Runner
- **名称**: `swqa-gh-runner-poc`
- **位置**: 能够访问Kubernetes集群内网的机器
- **职责**: 接收GitHub webhook，转发HTTP请求到Tekton EventListener
- **权限**: 最小化权限，只需要网络访问内网服务

### 3. Kubernetes集群 + Tekton
- **Tekton Pipelines**: 核心流水线引擎
- **Tekton Triggers**: 事件驱动组件
  - **EventListener**: 监听HTTP请求的内网服务
  - **TriggerBinding**: 解析GitHub payload参数
  - **TriggerTemplate**: 定义PipelineRun创建模板
- **Tekton Dashboard**: Web UI界面
  - 访问地址：http://tekton.10.117.3.193.nip.io
  - 用户名：admin
  - 密码：admin123

## 工作流程（Tekton Triggers模式）

1. **代码提交**: 开发者推送代码到GitHub main分支
2. **触发Actions**: GitHub Actions检测到push事件
3. **Runner处理**: 在`swqa-gh-runner-poc`上执行简化的workflow
4. **HTTP触发**: Runner发送HTTP POST到内网EventListener服务
5. **事件处理**: EventListener解析请求，通过TriggerTemplate创建PipelineRun
6. **执行测试**: Tekton Pipeline自动运行pytest测试
7. **结果查看**: 在Tekton Dashboard查看执行结果

## 项目结构

```
tekton-poc/
├── .github/
│   └── workflows/           # GitHub Actions配置（简化的Runner逻辑）
├── .tekton/                 # Tekton资源配置
│   ├── task-pytest.yaml           # Tekton Task定义
│   ├── pipeline.yaml              # Tekton Pipeline定义
│   ├── eventlistener.yaml         # EventListener配置
│   ├── triggerbinding.yaml        # TriggerBinding配置
│   └── triggertemplate.yaml       # TriggerTemplate配置
├── src/                     # 源代码
├── tests/                   # pytest测试文件
├── docs/
│   ├── zh/                 # 中文文档
│   └── en/                 # 英文文档
├── main.py                 # 主程序文件
├── pytest.ini             # pytest配置（包含标签定义）
└── requirements.txt        # Python依赖
```

## 下一步

请按照以下顺序阅读文档：

- [02 - 环境准备和安装](./02-环境准备和安装.md)
- [03 - Tekton Triggers配置](./03-Tekton-Triggers配置.md)  
- [04 - GitHub Actions配置](./04-GitHub-Actions配置.md)
- [05 - 端到端测试](./05-端到端测试.md)
